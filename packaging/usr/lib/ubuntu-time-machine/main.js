/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";var e={61:e=>{e.exports=function(e){return Object.defineProperties(t,{defaultLabel:{value:"",writable:!0},labelPadding:{value:!0,writable:!0},maxLabelLength:{value:0,writable:!0},labelLength:{get(){switch(typeof t.labelPadding){case"boolean":return t.labelPadding?t.maxLabelLength:0;case"number":return t.labelPadding;default:return 0}}}});function t(r){t.maxLabelLength=Math.max(t.maxLabelLength,r.length);const n={};for(const t of e.levels)n[t]=(...n)=>e.logData(n,{level:t,scope:r});return n.log=n.info,n}}},885:(e,t,r)=>{const n=r(61),o=r(7791);class i{static instances={};dependencies={};errorHandler=null;eventLogger=null;functions={};hooks=[];isDev=!1;levels=null;logId=null;scope=null;transports={};variables={};constructor({allowUnknownLevel:e=!1,dependencies:t={},errorHandler:r,eventLogger:a,initializeFn:s,isDev:c=!1,levels:l=["error","warn","info","verbose","debug","silly"],logId:u,transportFactories:d={},variables:f}={}){this.addLevel=this.addLevel.bind(this),this.create=this.create.bind(this),this.initialize=this.initialize.bind(this),this.logData=this.logData.bind(this),this.processMessage=this.processMessage.bind(this),this.allowUnknownLevel=e,this.buffering=new o(this),this.dependencies=t,this.initializeFn=s,this.isDev=c,this.levels=l,this.logId=u,this.scope=n(this),this.transportFactories=d,this.variables=f||{};for(const e of this.levels)this.addLevel(e,!1);this.log=this.info,this.functions.log=this.log,this.errorHandler=r,r?.setOptions({...t,logFn:this.error}),this.eventLogger=a,a?.setOptions({...t,logger:this});for(const[e,r]of Object.entries(d))this.transports[e]=r(this,t);i.instances[u]=this}static getInstance({logId:e}){return this.instances[e]||this.instances.default}addLevel(e,t=this.levels.length){!1!==t&&this.levels.splice(t,0,e),this[e]=(...t)=>this.logData(t,{level:e}),this.functions[e]=this[e]}catchErrors(e){return this.processMessage({data:["log.catchErrors is deprecated. Use log.errorHandler instead"],level:"warn"},{transports:["console"]}),this.errorHandler.startCatching(e)}create(e){return"string"==typeof e&&(e={logId:e}),new i({dependencies:this.dependencies,errorHandler:this.errorHandler,initializeFn:this.initializeFn,isDev:this.isDev,transportFactories:this.transportFactories,variables:{...this.variables},...e})}compareLevels(e,t,r=this.levels){const n=r.indexOf(e),o=r.indexOf(t);return-1===o||-1===n||o<=n}initialize(e={}){this.initializeFn({logger:this,...this.dependencies,...e})}logData(e,t={}){this.buffering.enabled?this.buffering.addMessage({data:e,...t}):this.processMessage({data:e,...t})}processMessage(e,{transports:t=this.transports}={}){if("errorHandler"===e.cmd)return void this.errorHandler.handle(e.error,{errorName:e.errorName,processType:"renderer",showDialog:Boolean(e.showDialog)});let r=e.level;this.allowUnknownLevel||(r=this.levels.includes(e.level)?e.level:"info");const n={date:new Date,logId:this.logId,...e,level:r,variables:{...this.variables,...e.variables}};for(const[r,o]of this.transportEntries(t))if("function"==typeof o&&!1!==o.level&&this.compareLevels(o.level,e.level))try{const e=this.hooks.reduce(((e,t)=>e?t(e,o,r):e),n);e&&o({...e,data:[...e.data]})}catch(e){this.processInternalErrorFn(e)}}processInternalErrorFn(e){}transportEntries(e=this.transports){return(Array.isArray(e)?e:Object.entries(e)).map((e=>{switch(typeof e){case"string":return this.transports[e]?[e,this.transports[e]]:null;case"function":return[e.name,e];default:return Array.isArray(e)?e:null}})).filter(Boolean)}}e.exports=i},3616:e=>{const t=console.error;e.exports=class{logFn=null;onError=null;showDialog=!1;preventDefault=!0;constructor({logFn:e=null}={}){this.handleError=this.handleError.bind(this),this.handleRejection=this.handleRejection.bind(this),this.startCatching=this.startCatching.bind(this),this.logFn=e}handle(e,{logFn:r=this.logFn,errorName:n="",onError:o=this.onError,showDialog:i=this.showDialog}={}){try{!1!==o?.({error:e,errorName:n,processType:"renderer"})&&r({error:e,errorName:n,showDialog:i})}catch{t(e)}}setOptions({logFn:e,onError:t,preventDefault:r,showDialog:n}){"function"==typeof e&&(this.logFn=e),"function"==typeof t&&(this.onError=t),"boolean"==typeof r&&(this.preventDefault=r),"boolean"==typeof n&&(this.showDialog=n)}startCatching({onError:e,showDialog:t}={}){this.isActive||(this.isActive=!0,this.setOptions({onError:e,showDialog:t}),window.addEventListener("error",(e=>{this.preventDefault&&e.preventDefault?.(),this.handleError(e.error||e)})),window.addEventListener("unhandledrejection",(e=>{this.preventDefault&&e.preventDefault?.(),this.handleRejection(e.reason||e)})))}handleError(e){this.handle(e,{errorName:"Unhandled"})}handleRejection(e){const t=e instanceof Error?e:new Error(JSON.stringify(e));this.handle(t,{errorName:"Unhandled rejection"})}}},4857:(e,t,r)=>{const{transform:n}=r(8915);e.exports=function(e){return Object.assign((function t(r){t.writeFn({message:{...r,data:n({logger:e,message:r,transport:t})}})}),{format:"{h}:{i}:{s}.{ms}{scope} â€º {text}",transforms:[i],writeFn({message:{level:e,data:t}}){const r=o[e]||o.info;setTimeout((()=>r(...t)))}})};const o={error:console.error,warn:console.warn,info:console.info,verbose:console.info,debug:console.debug,silly:console.debug,log:console.log};function i({data:e=[],logger:t={},message:r={},transport:n={}}){if("function"==typeof n.format)return n.format({data:e,level:r?.level||"info",logger:t,message:r,transport:n});if("string"!=typeof n.format)return e;e.unshift(n.format),"string"==typeof e[1]&&e[1].match(/%[1cdfiOos]/)&&(e=[`${e[0]} ${e[1]}`,...e.slice(2)]);const o=r.date||new Date;return e[0]=e[0].replace(/\{(\w+)}/g,((e,n)=>{switch(n){case"level":return r.level;case"logId":return r.logId;case"scope":{const e=r.scope||t.scope?.defaultLabel;return e?` (${e})`:""}case"text":return"";case"y":return o.getFullYear().toString(10);case"m":return(o.getMonth()+1).toString(10).padStart(2,"0");case"d":return o.getDate().toString(10).padStart(2,"0");case"h":return o.getHours().toString(10).padStart(2,"0");case"i":return o.getMinutes().toString(10).padStart(2,"0");case"s":return o.getSeconds().toString(10).padStart(2,"0");case"ms":return o.getMilliseconds().toString(10).padStart(3,"0");case"iso":return o.toISOString();default:return r.variables?.[n]||e}})).trim(),e}},6393:(e,t,r)=>{const n=r(885),o=r(3616),i=r(4857),a=r(6954);e.exports=function(){const e=new n({allowUnknownLevel:!0,errorHandler:new o,initializeFn:()=>{},logId:"default",transportFactories:{console:i,ipc:a},variables:{processType:"renderer"}});return e.errorHandler.setOptions({logFn({error:t,errorName:r,showDialog:n}){e.transports.console({data:[r,t].filter(Boolean),level:"error"}),e.transports.ipc({cmd:"errorHandler",error:{cause:t?.cause,code:t?.code,name:t?.name,message:t?.message,stack:t?.stack},errorName:r,logId:e.logId,showDialog:n})}}),"object"==typeof window&&window.addEventListener("message",(e=>{const{cmd:t,logId:r,...o}=e.data||{},i=n.getInstance({logId:r});"message"===t&&i.processMessage(o,{transports:["console"]})})),new Proxy(e,{get:(t,r)=>void 0!==t[r]?t[r]:(...t)=>e.logData(t,{level:r})})}(),e.exports.Logger=n,e.exports.default=e.exports},6954:(e,t,r)=>{const{transform:n}=r(8915);e.exports=function(e){return Object.assign((function t(r){if(window.__electronLog)try{const o=n({initialData:r,logger:e,message:r,transport:t});__electronLog.sendToMain(o)}catch(t){e.transports.console({data:["electronLog.transports.ipc",t,"data:",r.data],level:"error"})}else e.processMessage({data:["electron-log: logger isn't initialized in the main process"],level:"error"},{transports:["console"]})}),{depth:5,transforms:[a]})};const o=new Set([Promise,WeakMap,WeakSet]);function i(e){return Object(e)!==e}function a({data:e,depth:t,seen:r=new WeakSet,transport:n={}}={}){const s=t||n.depth||5;return r.has(e)?"[Circular]":s<1?i(e)?e:Array.isArray(e)?"[Array]":`[${typeof e}]`:["function","symbol"].includes(typeof e)?e.toString():i(e)?e:o.has(e.constructor)?`[${e.constructor.name}]`:Array.isArray(e)?e.map((e=>a({data:e,depth:s-1,seen:r}))):e instanceof Date?e.toISOString():e instanceof Error?e.stack:e instanceof Map?new Map(Array.from(e).map((([e,t])=>[a({data:e,depth:s-1,seen:r}),a({data:t,depth:s-1,seen:r})]))):e instanceof Set?new Set(Array.from(e).map((e=>a({data:e,depth:s-1,seen:r})))):(r.add(e),Object.fromEntries(Object.entries(e).map((([e,t])=>[e,a({data:t,depth:s-1,seen:r})]))))}},7791:e=>{e.exports=class{constructor({processMessage:e}){this.processMessage=e,this.buffer=[],this.enabled=!1,this.begin=this.begin.bind(this),this.commit=this.commit.bind(this),this.reject=this.reject.bind(this)}addMessage(e){this.buffer.push(e)}begin(){this.enabled=[]}commit(){this.enabled=!1,this.buffer.forEach((e=>this.processMessage(e))),this.buffer=[]}reject(){this.enabled=!1,this.buffer=[]}}},8915:e=>{e.exports={transform:function({logger:e,message:t,transport:r,initialData:n=t?.data||[],transforms:o=r?.transforms}){return o.reduce(((n,o)=>"function"==typeof o?o({data:n,logger:e,message:t,transport:r}):n),n)}}}},t={};const r=require("electron"),n=require("path"),o=require("fs"),i=require("child_process");var a=function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,r),i.exports}(6393);function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function c(){c=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",l=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function d(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{d({},"")}catch(e){d=function(e,t,r){return e[t]=r}}function f(e,t,r,n){var i=t&&t.prototype instanceof y?t:y,a=Object.create(i.prototype),s=new C(n||[]);return o(a,"_invoke",{value:O(e,r,s)}),a}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=f;var p="suspendedStart",g="suspendedYield",m="executing",v="completed",w={};function y(){}function b(){}function x(){}var L={};d(L,a,(function(){return this}));var S=Object.getPrototypeOf,E=S&&S(S(I([])));E&&E!==r&&n.call(E,a)&&(L=E);var k=x.prototype=y.prototype=Object.create(L);function D(e){["next","throw","return"].forEach((function(t){d(e,t,(function(e){return this._invoke(t,e)}))}))}function j(e,t){function r(o,i,a,c){var l=h(e[o],e,i);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==s(d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,a,c)}),(function(e){r("throw",e,a,c)})):t.resolve(d).then((function(e){u.value=e,a(u)}),(function(e){return r("throw",e,a,c)}))}c(l.arg)}var i;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return i=i?i.then(o,o):o()}})}function O(t,r,n){var o=p;return function(i,a){if(o===m)throw Error("Generator is already running");if(o===v){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var c=F(s,n);if(c){if(c===w)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===p)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var l=h(t,r,n);if("normal"===l.type){if(o=n.done?v:g,l.arg===w)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=v,n.method="throw",n.arg=l.arg)}}}function F(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,F(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),w;var i=h(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,w;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,w):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,w)}function M(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(M,this),this.reset(!0)}function I(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return i.next=i}}throw new TypeError(s(t)+" is not iterable")}return b.prototype=x,o(k,"constructor",{value:x,configurable:!0}),o(x,"constructor",{value:b,configurable:!0}),b.displayName=d(x,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,x):(e.__proto__=x,d(e,u,"GeneratorFunction")),e.prototype=Object.create(k),e},t.awrap=function(e){return{__await:e}},D(j.prototype),d(j.prototype,l,(function(){return this})),t.AsyncIterator=j,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new j(f(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},D(k),d(k,u,"Generator"),d(k,a,(function(){return this})),d(k,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=I,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),l=n.call(a,"finallyLoc");if(c&&l){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,w):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),w},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),P(r),w}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;P(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:I(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),w}},t}function l(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function u(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){l(i,n,o,a,s,"next",e)}function s(e){l(i,n,o,a,s,"throw",e)}a(void 0)}))}}a.transports.console.level="debug",a.transports.file.level="debug",a.info("Application starting");var d=null,f=null,h=!1,p=n.join(process.resourcesPath,"bin/utm-core");function g(){a.info("Creating main window"),d=new r.BrowserWindow({width:1200,height:800,minWidth:800,minHeight:600,webPreferences:{nodeIntegration:!1,contextIsolation:!0,preload:n.join(__dirname,"preload.js")},show:!1});var e=n.join(__dirname,"../index.html");return a.info("Loading HTML from: ".concat(e)),d.loadFile(e),d.once("ready-to-show",(function(){a.info("Main window ready to show"),d&&d.show()})),d.on("close",(function(e){return a.debug("Window close event triggered"),h?(a.info("Window closing"),!0):(a.info("Hiding window instead of closing"),e.preventDefault(),d&&d.hide(),!1)})),d.on("closed",(function(){a.info("Main window closed"),d=null})),d}function m(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var o;a.debug("Sending to renderer: ".concat(e),r),d&&d.webContents?(o=d.webContents).send.apply(o,[e].concat(r)):a.warn("Failed to send to renderer: ".concat(e," (window not available)"))}function v(){a.info("Checking for updates")}a.info("Core executable path: ".concat(p)),a.info("Development mode: ".concat(!1)),r.app.whenReady().then((function(){if(a.info("Electron app ready"),g(),function(){a.info("Creating system tray");var e=n.join(__dirname,"..","assets","icons","16x16.png");if(a.debug("Looking for icon at: ".concat(e)),!o.existsSync(e)){var t=n.join(__dirname,"assets","icons","16x16.png");a.debug("Primary icon not found, trying alternate path: ".concat(t)),e=t,o.existsSync(n.dirname(e))||(a.debug("Creating icon directory"),o.mkdirSync(n.dirname(e),{recursive:!0}),o.writeFileSync(e,""),a.debug("Created empty icon file as fallback"))}a.info("Using icon from: ".concat(e)),f=new r.Tray(e);var i=r.Menu.buildFromTemplate([{label:"Show Ubuntu Time Machine",click:function(){a.info("Tray: Show application clicked"),d&&d.show()}},{type:"separator"},{label:"Perform Backup Now",click:function(){a.info("Tray: Perform Backup clicked"),m("trigger-backup")}},{label:"Check for Updates",click:function(){a.info("Tray: Check for Updates clicked"),v()}},{type:"separator"},{label:"Quit",click:function(){a.info("Tray: Quit clicked"),h=!0,r.app.quit()}}]);f.setToolTip("Ubuntu Time Machine"),f.setContextMenu(i),f.on("click",(function(){a.debug("Tray icon clicked"),d&&(d.isVisible()?(a.info("Hiding main window from tray click"),d.hide()):(a.info("Showing main window from tray click"),d.show()))}))}(),a.debug("Checking if core exists at: ".concat(p)),!o.existsSync(p))return a.error("Core binary not found at: ".concat(p)),r.dialog.showErrorBox("Core Component Missing","The core backup component was not found at: ".concat(p)),void r.app.quit();a.info("Core binary verified"),a.info("Setting up IPC handlers"),r.ipcMain.handle("execute-core-command",function(){var e=u(c().mark((function e(t,r){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.info("Executing core command with args: ".concat(r.join(" "))),e.abrupt("return",new Promise((function(e,t){a.debug("Spawning process: ".concat(p," ").concat(r.join(" ")));var n=i.spawn(p,r),o="",s="";n.stdout.on("data",(function(e){var t=e.toString();o+=t,a.debug("Core stdout: ".concat(t.trim())),m("core-command-output",t)})),n.stderr.on("data",(function(e){var t=e.toString();s+=t,a.warn("Core stderr: ".concat(t.trim())),m("core-command-error",t)})),n.on("close",(function(r){a.info("Core command completed with code: ".concat(r)),0===r?(a.debug("Command successful"),e({success:!0,stdout:o,stderr:s})):(a.error("Command failed with code ".concat(r)),t({success:!1,code:r,stdout:o,stderr:s}))})),n.on("error",(function(e){a.error("Error executing core command: ".concat(e.message)),t({success:!1,error:e.message})}))})));case 2:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()),r.ipcMain.handle("get-backup-profiles",u(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.info("Getting backup profiles"),e.abrupt("return",new Promise((function(e,t){a.debug("Executing: ".concat(p," --list-profiles"));var r=i.spawn(p,["--list-profiles"]),n="",o="";r.stdout.on("data",(function(e){var t=e.toString();n+=t,a.debug("Profile list stdout: ".concat(t.trim()))})),r.stderr.on("data",(function(e){var t=e.toString();o+=t,a.warn("Profile list stderr: ".concat(t.trim()))})),r.on("close",(function(r){if(a.info("Profile list command completed with code: ".concat(r)),0===r){var i=n.split("\n").filter((function(e){return e.trim().startsWith("-")})).map((function(e){return e.trim().substring(2).trim()}));a.info("Found ".concat(i.length," profiles")),a.debug("Profiles: ".concat(JSON.stringify(i))),e(i)}else a.error("Profile list failed with code ".concat(r,": ").concat(o)),t({code:r,stderr:o})})),r.on("error",(function(e){a.error("Error listing profiles: ".concat(e.message)),t(e)}))})));case 2:case"end":return e.stop()}}),e)})))),r.ipcMain.handle("open-external-url",function(){var e=u(c().mark((function e(t,n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.info("Opening external URL: ".concat(n)),e.abrupt("return",r.shell.openExternal(n));case 2:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()),r.ipcMain.handle("show-open-directory-dialog",u(c().mark((function e(){var t;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.info("Showing directory selection dialog"),e.next=3,r.dialog.showOpenDialog({properties:["openDirectory"]});case 3:return t=e.sent,a.info("Directory selection result: ".concat(t.canceled?"canceled":t.filePaths.join(", "))),e.abrupt("return",t.filePaths);case 6:case"end":return e.stop()}}),e)})))),a.info("IPC handlers setup complete"),a.info("Scheduling update check"),setTimeout(v,3e3)})),r.app.requestSingleInstanceLock()?(a.info("Got single instance lock"),r.app.on("second-instance",(function(){a.info("Second instance detected, focusing main window"),d&&(d.isMinimized()&&d.restore(),d.show(),d.focus())}))):(a.warn("Another instance is already running. Quitting this instance."),r.app.quit()),r.app.on("activate",(function(){a.debug("Activate event triggered"),0===r.BrowserWindow.getAllWindows().length&&(a.info("No windows found, creating main window"),g())})),r.app.on("before-quit",(function(){a.info("Application is preparing to quit"),h=!0})),r.app.on("quit",(function(){a.info("Application is quitting"),f=null}))})();